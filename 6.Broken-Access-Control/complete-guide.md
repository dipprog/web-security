# Broken Access Control

## Some Terminology

### `Authentication`

Authentication is the process of verifying the identity of an entity, such as a person or a system, to ensure that they are who they claim to be. It is commonly used in various contexts, including computer systems, online services, and physical access control. To understand authentication better, let's delve into the concept with an example and a real-life analogy.

Example: Let's consider a scenario where you want to access your online banking account. When you attempt to log in, you are prompted to enter your username and password. This process is an example of authentication.

1. Username and Password: In this case, your username serves as a unique identifier, while your password acts as a secret credential known only to you. By entering the correct combination of username and password, you are authenticating yourself to the system. If the credentials match the records stored by the bank, you are granted access to your account.

2. Two-Factor Authentication (2FA): Many systems employ an additional layer of security called two-factor authentication. In this method, after entering your username and password, you are required to provide a second form of verification. This could be a temporary code sent to your registered mobile phone or generated by an authentication app. The code serves as a time-based or event-based password that must be entered correctly to complete the authentication process.

Real-life Analogy: Let's compare authentication to a physical scenario most people are familiar with — a club entrance.

Imagine you're going to a popular nightclub. At the entrance, there are two bouncers responsible for verifying the identity of the club's patrons:

1. Showing ID: The first bouncer asks for your identification, such as a driver's license or passport. This ID serves as your unique identifier, just like a username. It helps the bouncer confirm that you are of legal age and have the right to enter the club.

2. Matching Face: The second bouncer compares your face to the picture on the ID to ensure that you are the rightful owner of the ID. This step is akin to verifying your password — your face serves as a secret credential that only you possess.

Together, the process of showing your ID and matching your face allows the bouncers to authenticate your identity. If the bouncers are satisfied that you are indeed the person you claim to be, you are granted access to the club.

Similarly, in digital authentication, the combination of a unique identifier (e.g., username) and a secret credential (e.g., password) confirms your identity to the system, granting you access to the desired resources or services.

It's worth noting that authentication mechanisms can vary depending on the context, and there are additional methods like biometrics (fingerprint, facial recognition), hardware tokens, and certificates. The goal of authentication is to establish trust and ensure that only authorized individuals or systems can access sensitive information or perform certain actions.

### `Session Management`

Session management is a crucial aspect of web applications and systems that involves maintaining and controlling the interaction between a user and the server over a specific period, known as a `session`. It helps ensure the continuity and security of user interactions. To understand session management better, let's explore the concept with an example and a real-life analogy.

Example: Consider a scenario where you are using an online shopping website to purchase items. When you visit the website and log in, a session is created to track your activities and maintain your state throughout your shopping experience.

1. `Session Creation`: When you log in, the server creates a unique session ID for you and associates it with your user account. This session ID is typically stored in a browser cookie or appended to URLs.

2. `Session Tracking`: As you browse the website, add items to your shopping cart, and proceed to checkout, the session ID is sent back to the server with each request. The server uses this session ID to identify and track your session, allowing it to retrieve relevant information and maintain your context, such as the contents of your cart and your preferences.

3. `Session Termination`: When you log out or after a certain period of inactivity, the session is terminated. This involves deleting the session ID and any associated data from the server. The next time you visit the website, you will need to log in again to create a new session.

Real-life Analogy: A real-life analogy to session management can be visiting a **theme park**.

1. `Ticket Issuance`: When you arrive at the theme park, you purchase a ticket. This ticket represents your entry pass and is analogous to a session ID. It grants you access to various attractions within the park.

2. `Access and Activities`: With your ticket, you can freely move around the park, enjoying different rides and activities. The staff at each attraction may verify your ticket to ensure you have access.

3. `Session Termination`: At the end of the day or when the park closes, your session comes to an end. You leave the park, and your ticket is no longer valid. To re-enter the park the next day, you would need to purchase a new ticket.

Similarly, in session management, the session ID acts as your access pass to the web application or system. It enables the server to maintain your state, track your activities, and provide a personalized experience. Once the session is terminated, either by logging out or due to inactivity, you need to create a new session by logging in again.

Session management is essential for security and user experience. It allows the system to authenticate users, authorize their actions, and prevent unauthorized access to sensitive information. It also enables the system to remember user preferences, maintain shopping carts, and provide personalized content without requiring users to re-enter their credentials repeatedly.

It's worth noting that session management techniques may involve additional security measures, such as session timeouts, secure session storage, and protection against session hijacking or fixation attacks.

### `Access Control`

Access control is a fundamental concept in information security that involves managing and regulating who can access specific resources or perform certain actions within a system. It ensures that only authorized individuals or entities can access sensitive information or perform critical operations. To understand access control better, let's explore the concept with an example and a real-life analogy.

Example: Let's consider a scenario where you work in a company with different levels of access permissions based on job roles. The company's computer network employs access control mechanisms to safeguard sensitive data and restrict access to authorized personnel.

1. Role-based Access Control (RBAC): In this access control model, different job roles are assigned specific permissions based on their responsibilities. For example, a manager might have access to financial reports, while a regular employee may only have access to their own work-related documents. Access is granted based on predefined rules that align with the employees' roles and responsibilities.

2. Access Permissions: Access permissions can be defined at various levels, such as file level, folder level, or system level. For instance, certain folders containing confidential documents may only be accessible to managers or specific teams, while other folders with general information are accessible to all employees. This granular control ensures that access is granted on a need-to-know basis.

3. Access Control Lists (ACL): An ACL is a list associated with each resource, specifying the permissions granted to different users or groups. For example, an ACL might include entries allowing read and write access to a file for the HR department but only read access for other departments. These entries determine who can perform which actions on the resource.

Real-life Analogy: A real-life analogy for access control can be a secure building with restricted areas and access cards.

1. Access Cards: In a secure building, employees are issued access cards that grant them entry to specific areas based on their job roles. These access cards are analogous to user accounts in a computer system.

2. Restricted Areas: The building may have certain areas, such as server rooms, executive offices, or sensitive storage rooms, that require special permissions to enter. These restricted areas are similar to the sensitive data or critical operations in a computer system.

3. Access Control System: The building employs an access control system with card readers at various entry points. Each access card is programmed with specific permissions that determine which areas the employee can enter. The system verifies the card's credentials and grants or denies access accordingly.

Similarly, in access control for computer systems, user accounts are assigned specific permissions that dictate their level of access to resources. Access control mechanisms, such as RBAC and ACLs, regulate who can access certain files, databases, or system functions. By implementing access control, organizations can protect sensitive information, maintain data privacy, and prevent unauthorized actions or breaches.

It's important to note that access control can be further enhanced with additional security measures like multi-factor authentication, audit logs, and regular access reviews to ensure ongoing compliance and mitigate potential risks.

Three types of access control:

**Vertical Access Control**
Vertical access control is a type of access control that focuses on controlling access to resources based on hierarchical levels of authority or sensitivity. It ensures that individuals or entities can access information or perform actions based on their clearance level or need-to-know basis. To understand vertical access control better, let's explore the concept with an example and a real-life analogy.

Example: Consider a government organization with classified information divided into different security clearance levels, such as Top Secret, Secret, and Confidential. Vertical access control is employed to restrict access to information based on the clearance level of individuals.

1. Security Clearance Levels: Each individual within the organization is assigned a specific security clearance level based on their job responsibilities and the sensitivity of the information they need to access. For example, individuals working on highly classified projects may be granted Top Secret clearance, while those with less sensitive roles may have Confidential clearance.

2. Need-to-Know Basis: Vertical access control ensures that individuals can only access information up to their authorized clearance level and on a need-to-know basis. For instance, individuals with Secret clearance may be allowed access to Secret and Confidential information, but not to Top Secret information unless they have a specific need to access it for their job tasks.

3. Access Controls and Authorization: Access controls are implemented at various levels, such as physical, logical, or data access controls, to enforce vertical access control. These controls may include badge access to restricted areas, user authentication mechanisms, encryption of sensitive data, or software restrictions.

Real-life Analogy: A real-life analogy for vertical access control can be seen in military or intelligence organizations.

1. Security Clearance Levels: In these organizations, individuals are granted different security clearance levels based on their roles, responsibilities, and the sensitivity of information they need to access. For example, a soldier may have a lower clearance level compared to a high-ranking officer or an intelligence analyst working with classified data.

2. Classified Information: The organization classifies information into various levels, such as Top Secret, Secret, and Confidential. This categorization determines who can access specific information based on their security clearance level and need-to-know basis. Individuals can access information only up to their authorized clearance level.

3. Access Controls: Access controls, both physical and digital, are implemented to enforce vertical access control. Physical access controls may include restricted areas with badge access or biometric authentication. Digital access controls involve authentication mechanisms, encryption, and role-based access control (RBAC) systems that enforce clearance-based permissions.

In both the example and the real-life analogy, vertical access control ensures that access to sensitive or classified information is strictly controlled and limited to individuals with the necessary clearance levels. It prevents unauthorized disclosure or leakage of sensitive data and ensures that individuals only access information relevant to their roles and responsibilities.

It's important to note that vertical access control is often complemented by other access control models, such as role-based access control (RBAC) or attribute-based access control (ABAC), to provide a comprehensive and layered security approach.

**Horizontal Access Control**

**Context-Dependent Access Control**
Context-Dependent Access Control (CDAC) is an access control mechanism that takes into account contextual factors when determining access permissions. It considers various elements such as user attributes, environmental conditions, and system state to make access control decisions. CDAC allows for fine-grained access control based on specific contextual factors. To understand CDAC better, let's explore the concept with an example and a real-life analogy.

Example: Imagine a healthcare system that implements CDAC to control access to patient records. Different contextual factors are considered before granting access to the records.

1. User Attributes: CDAC considers user attributes such as job role, department, and training level. For example, doctors might have access to a broader range of patient records compared to nurses or administrative staff.

2. Environmental Conditions: CDAC takes into account the environmental conditions at the time of access. For instance, it may restrict access to patient records when a user is accessing the system from an unsecured network or outside of specific authorized locations.

3. System State: CDAC considers the state of the system itself. For instance, access permissions might be adjusted during maintenance periods or if the system detects suspicious behavior, such as multiple failed login attempts.

Based on these contextual factors, the CDAC mechanism dynamically determines whether to grant or deny access to patient records, ensuring that only authorized users with the appropriate attributes and within the defined environmental conditions can access the information.

Real-life Analogy: An analogy for CDAC can be seen in a high-security research facility.

1. User Credentials: Access to different areas of the facility is controlled based on user credentials such as security clearances, job roles, and training levels. Scientists working on highly classified projects might have access to more restricted areas compared to maintenance staff or visitors.

2. Environmental Factors: The facility might implement CDAC based on environmental factors. For example, access to certain areas may require additional authentication or clearance during specific times, such as outside normal working hours or during emergency situations.

3. System Monitoring: The facility's security system continuously monitors the state of various security components. If a breach is detected or an alarm is triggered, access permissions may be dynamically adjusted to restrict access to certain areas until the situation is resolved.

In this analogy, the research facility implements CDAC by considering user credentials, environmental factors, and system state to determine access permissions to different areas of the facility. Only individuals with the appropriate credentials and within the defined context can access specific areas.

Context-Dependent Access Control provides a more dynamic and flexible approach to access control, allowing organizations to tailor access permissions based on specific contextual factors. It enhances security by ensuring that access is granted based on relevant attributes and conditions, reducing the risk of unauthorized access or data breaches.

## Broken Access Control Vulnerabilities

Broken access control refers to a security vulnerability where an attacker can gain unauthorized access to resources or perform actions they should not have permission for. It occurs when access controls are improperly implemented, enforced, or bypassed, leading to unauthorized operations.

Example: Imagine a web application where users can view their own profile by accessing a URL like "example.com/profile?id=123". However, due to a broken access control vulnerability, an attacker can change the ID parameter to access profiles of other users, exposing their sensitive information.

Real-life Analogy: Think of a building with different floors and keycard access control. In this analogy, broken access control would occur if a flaw in the keycard system allows someone with a regular access card to enter highly secure floors, such as the executive boardroom or server room, bypassing the intended access restrictions.

In both the example and the real-life analogy, broken access control allows unauthorized individuals to gain access to resources or perform actions they should not have the privilege for. This can lead to unauthorized disclosure of sensitive information, manipulation of data, or even complete compromise of a system's security.

To prevent broken access control, it is crucial to implement proper access control measures, including strong authentication, authorization checks, and consistent enforcement of access restrictions. Regular security assessments and code reviews can help identify and fix potential vulnerabilities to ensure robust access control within a system or application.

## Horizontal Privilege Escalation

Horizontal privilege escalation refers to a security vulnerability where an attacker gains unauthorized access to resources or performs actions beyond their intended privileges within the same level of authority. It occurs when the system fails to enforce proper access controls, allowing an attacker to escalate their privileges horizontally.

Example: Consider a web application where users have different roles, such as regular users and administrators. A horizontal privilege escalation vulnerability might exist if a regular user discovers a flaw that allows them to manipulate the system and gain administrative access, granting them the ability to perform actions reserved for administrators.

Real-life Analogy: Imagine a company with different levels of access in the office building. Horizontal privilege escalation would be similar to a scenario where an employee finds a way to exploit a flaw in the security system and gain access to restricted areas that are typically only accessible to higher-level managers, despite not having the appropriate clearance.

In both the example and the real-life analogy, horizontal privilege escalation occurs when an attacker can bypass access controls and gain unauthorized access or perform actions beyond their assigned privileges. This can lead to unauthorized data manipulation, exposure of sensitive information, or compromise of the system's security.

To prevent horizontal privilege escalation, it is crucial to implement robust access controls, properly segregating user roles and enforcing restrictions on their actions and access privileges. Regular security assessments, vulnerability scanning, and code reviews can help identify and fix potential vulnerabilities, ensuring that users can only access resources and perform actions that are within their authorized scope.

## Vertical Privilege Escalation

Vertical privilege escalation refers to a security vulnerability where an attacker gains unauthorized access to resources or performs actions beyond their intended privileges by escalating their level of authority. It occurs when a system fails to properly enforce access controls, allowing an attacker to gain higher privileges within the system.

Example: Consider a web application where users have different privilege levels, such as regular users and administrators. A vertical privilege escalation vulnerability might exist if a regular user discovers a flaw that allows them to manipulate the system and elevate their privileges to gain administrative access, granting them more control and privileges than they should have.

Real-life Analogy: Think of a workplace with different levels of authority, such as employees and managers. Vertical privilege escalation would be similar to a scenario where an employee exploits a vulnerability in the company's processes or systems to gain access to managerial functions or confidential information that is typically only accessible to managers.

In both the example and the real-life analogy, vertical privilege escalation occurs when an attacker can bypass access controls and gain unauthorized access or perform actions beyond their assigned privileges, reaching higher levels of authority within the system. This can result in unauthorized manipulation of sensitive data, unauthorized changes to system configurations, or compromise of the system's security.

To prevent vertical privilege escalation, it is crucial to implement strong access controls, ensure proper segregation of duties, and enforce restrictions on user privileges. Regular security assessments, penetration testing, and code reviews can help identify and address vulnerabilities, ensuring that users can only access resources and perform actions according to their authorized level of authority.

## Access Control Vulnerabilities in Multi-Step Processes

Vertical privilege escalation in multi-step processes refers to a security vulnerability where an attacker gains unauthorized access to higher levels of authority or performs actions beyond their intended privileges by exploiting weaknesses in multi-step workflows or processes. This vulnerability occurs when access controls are insufficiently enforced or verified at each step of the process.

Example: Consider an online shopping platform where users can place orders and process payments. If there is a vertical privilege escalation vulnerability in a multi-step checkout process, an attacker could manipulate the system to bypass payment authorization and gain access to sensitive order details or even modify payment amounts.

Real-life Analogy: Imagine a scenario where a customer visits a high-security bank to withdraw money. The bank has multiple security checkpoints in place, such as identification verification, account verification, and transaction authorization. If there is a vulnerability in the process that allows a customer to bypass these steps and withdraw more money than their account balance permits, it would represent a vertical privilege escalation vulnerability in a multi-step process.

In both the example and the real-life analogy, vertical privilege escalation in multi-step processes occurs when an attacker exploits weaknesses in the process flow to gain unauthorized access or perform actions beyond their intended privileges. This can result in financial loss, unauthorized access to sensitive information, or disruption of the system's integrity.

To prevent vertical privilege escalation in multi-step processes, it is crucial to implement robust access controls and verification mechanisms at each step of the workflow. This includes properly authenticating users, validating their permissions and privileges, and conducting necessary checks and authorizations throughout the process. Regular security assessments, testing, and adherence to secure coding practices can help identify and address vulnerabilities, ensuring that access controls are enforced effectively throughout multi-step processes.

## Other Access Control Examples

- Bypassing access control checks by modifying parameters in the URL or HTML page.
- Accessing the API with missing access controls on the POST, PUT and DELETE methods.
- Manipulating metadata, such as replaying or tampering with JSON Web Tokens (JWTs) or a cookie.
- Exploiting CORS misconfiguration that allow API access from unauthorized / untrusted origins.
- Force browsing to authenticated pages as an unauthenticated user.

## Impact of Acess control vulnerabilities

Access control vulnerabilities can have significant impacts on the security and integrity of a system or organization. Here are some key impacts of access control vulnerabilities:

1. Unauthorized Access: Access control vulnerabilities can allow unauthorized individuals to gain access to sensitive resources, systems, or information. This can result in unauthorized data manipulation, theft of sensitive information, or misuse of system functionalities.

2. Data Breaches: When access controls are weak or improperly enforced, it increases the risk of data breaches. Attackers can exploit vulnerabilities to gain access to confidential data, compromising the privacy of individuals or organizations. This can lead to financial loss, reputational damage, or legal consequences.

3. Privilege Escalation: Access control vulnerabilities can enable attackers to escalate their privileges, granting them higher levels of access or administrative capabilities within a system. Privilege escalation can lead to unauthorized modifications, unauthorized access to critical resources, or even complete compromise of the system.

4. Information Leakage: Weak access controls can result in unauthorized disclosure of sensitive information. Attackers can exploit vulnerabilities to bypass access restrictions and gain knowledge or insights that should be restricted to certain individuals or roles. This can harm business competitiveness, violate privacy regulations, or lead to financial losses.

5. Disruption of Operations: Access control vulnerabilities can disrupt normal system operations. Attackers may gain unauthorized access and manipulate system configurations, delete important data, or launch denial-of-service attacks. Such disruptions can cause downtime, loss of productivity, financial losses, or damage to the organization's reputation.

6. Compliance and Legal Issues: Organizations may face compliance violations and legal consequences due to access control vulnerabilities. Failure to implement proper access controls can result in non-compliance with industry regulations or data protection laws, leading to penalties, legal actions, or loss of customer trust.

To mitigate the impact of access control vulnerabilities, organizations should implement robust access control mechanisms, conduct regular security assessments, stay updated with security best practices, and address vulnerabilities promptly. Strong authentication, proper authorization, regular monitoring, and user access reviews are essential components of an effective access control strategy.

## How to find access control vulnerabilities

Finding access control vulnerabilities can be approached differently in black box and white box testing. Here's how you can identify access control vulnerabilities using both testing methodologies:

Black Box Testing:

1. `Fuzzing`: Perform input fuzzing to test how the system handles unexpected or malicious input. Submit various inputs to the application, including those that might bypass access controls or manipulate authorization parameters.

2. `Brute-Force Attacks`: Attempt to guess or brute-force credentials to determine if the system enforces proper authentication controls. This can help identify weak passwords or vulnerabilities in the authentication mechanism.

3. `Unauthorized Resource Access`: Test the system by accessing resources or functionalities that should be restricted based on user roles or privileges. For example, try to access administrative features using a non-administrator account.

4. `Parameter Tampering`: Manipulate parameters in requests and forms to check if the system performs proper authorization checks. Modify parameters to gain access to unauthorized resources or perform actions that should be restricted.

5. `Session Management`: Test session management mechanisms by manipulating session tokens or cookies to bypass authentication or gain unauthorized access.

White Box Testing:

1. `Code Review`: Analyze the application's source code to identify vulnerabilities related to access controls. Look for instances where access checks are missing, insufficient, or can be easily bypassed.

2. `Static Analysis`: Use static analysis tools to scan the codebase for potential access control vulnerabilities. These tools can identify coding patterns that may lead to authorization flaws or improper enforcement of access controls.

3. `Authorization Logic Analysis`: Analyze the application's authorization logic to ensure that access decisions are properly implemented and enforced throughout the codebase. Look for vulnerabilities related to business logic flaws, privilege escalation, or insecure direct object references (IDOR).

4. `Configuration Review`: Review the application's configuration files and settings to identify misconfigurations that may weaken access controls. Ensure that access control settings are properly configured and aligned with the intended security policies.

5. `Access Control Matrix Analysis`: Analyze the application's access control matrix or permission model to ensure that proper segregation of duties and access restrictions are in place. Check if roles and permissions are correctly defined and assigned.

6. `Session Handling`: Review how session management is implemented in the application. Verify that session tokens are securely generated, stored, and invalidated upon logout or session timeout.

By combining black box and white box testing approaches, you can effectively identify a wide range of access control vulnerabilities, including issues related to authentication, authorization, session management, input validation, and privilege escalation. It is recommended to follow a comprehensive testing methodology that includes both perspectives to maximize the chances of uncovering vulnerabilities and ensuring the robustness of access controls.

## How to exploit access control vulnerabilities

- Depends on the type of access control vulnerability.
- Usually just a matter of manipulated the vulnerable field / parameter.

## How to prevent ccess control vulnerabilities

Preventing access control vulnerabilities requires a proactive approach to security. Here are some important measures you can take to mitigate the risk of access control vulnerabilities:

1. Principle of Least Privilege: Implement the principle of least privilege, which means granting users the minimum privileges necessary to perform their tasks. Restrict access to sensitive resources and ensure that users only have the permissions required for their roles or responsibilities.

2. Strong Authentication: Enforce strong authentication mechanisms, such as multi-factor authentication (MFA) or biometric authentication, to verify the identity of users. This helps prevent unauthorized access to accounts and systems.

3. Robust Authorization: Implement robust authorization controls that accurately define and enforce access permissions. Use role-based access control (RBAC), attribute-based access control (ABAC), or other appropriate access control models to ensure granular and appropriate access levels.

4. Secure Session Management: Implement secure session management techniques to ensure that user sessions are properly authenticated, monitored, and terminated after a reasonable period of inactivity. This prevents session hijacking or unauthorized access through stolen or manipulated session tokens.

5. Input Validation and Sanitization: Apply strict input validation and sanitization techniques to prevent injection attacks. Validate and sanitize all user inputs to ensure they do not contain malicious code or unauthorized commands.

6. Regular Access Reviews: Conduct regular reviews of user access rights and permissions to ensure that access controls remain appropriate and up to date. Remove or modify access privileges when users change roles or responsibilities.

7. Secure Configuration Management: Ensure that the system and application configurations are secure and aligned with best practices. Disable unnecessary services, change default passwords, and apply security patches and updates promptly.

8. Security Training and Awareness: Provide security training to users and staff to educate them about access control best practices, the risks of unauthorized access, and the importance of safeguarding sensitive information.

9. Logging and Monitoring: Implement robust logging and monitoring mechanisms to track and detect unauthorized access attempts or suspicious activities. Regularly review logs and alerts to identify and respond to potential access control breaches.

10. Regular Security Assessments: Conduct regular security assessments, including penetration testing and vulnerability scanning, to identify potential access control vulnerabilities. Fix identified issues promptly and ensure that security assessments are part of the development and maintenance lifecycle.

By implementing these preventive measures, organizations can significantly reduce the likelihood of access control vulnerabilities and enhance the overall security posture of their systems and applications. It is essential to adopt a holistic approach to security and continually monitor and update access controls as new threats and vulnerabilities emerge.
